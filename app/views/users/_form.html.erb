<%= semantic_form_for @user, html: { multipart: true, class: 'form-row' } do |f| %>
  <%= f.input :avatar, as: :image, direct_upload: true, class: 'col-12' %>
  <%= f.input :email, class: 'col-sm-6' %>
  <%= f.input :name, class: 'col-sm-6' %>
  <%= f.input :password, class: 'col-sm-6' %>
  <%= f.input :password_confirmation, class: 'col-sm-6' %>
  
  <div class="dropzone dropzone-default dz-clickable" style="margin-top: 35px;"
      data-controller="dropzone"
      data-max-file-size="2"
      data-dropzone-max-files="100">
    <%= f.file_field :files, multiple: true, direct_upload: true, data: { target: "dropzone.input" }, class: 'col-sm-12' %>
    <div class="dropzone-msg dz-message needsclick">
      <h3 class="dropzone-msg-title" style="color: gray">Arraste os arquivos ou clique para carrega-los</h3>
      <span class="dropzone-msg-desc text-sm" style="color: gray">Máximo de 2 MB por imagem. Extensões aceitas: .png, .jpg</span>
      </div>
    </div>
  </div>

  <% if Role.allowed_roles(current_user).any? && @user.id != current_user.id %>
    <%= f.input :is_active, class: 'col-12' %>
    <% allowed_roles = Role.allowed_roles(current_user) %>
    <%= f.input :roles, as: :check_boxes, class: 'col-12', collection: Hash[allowed_roles.map { |r| ["#{t("roles.names.#{r.name}")}<span class=\"small\"> (#{t("roles.descriptions.#{r.name}")})</span>".html_safe, r.id] }] if allowed_roles.any? %>
  <% end %>

  <%= f.action :submit, label: "Salvar", :as => :button, class: 'col-12', html: { 'data-disable-with' => t('activerecord.link.sending') } %>
<% end %>

<script>
$( document ).on('turbolinks:load', function() {
// $(function(){
  jCheckBoxes = $("input[name='user[role_ids][]']");
  jCheckBoxes.on('change', function(){
    checkBox = this;
    jCheckBoxes.each(function(i, item){ item.checked = checkBox === item });
  });
});
</script>