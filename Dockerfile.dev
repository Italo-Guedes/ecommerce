FROM ruby:2.7.2-alpine

ENV APP_PATH /rdmapps
ENV BUNDLE_VERSION 2.1.4
ENV BUNDLE_PATH /usr/local/bundle/gems

RUN apk add --no-cache --update build-base openssl tar bash linux-headers git \
    postgresql-dev tzdata postgresql-client less imagemagick python2 \
    npm yarn && \
    rm -rf /tmp/* /var/tmp/* && \
    rm -rf /var/cache/apk/*

RUN mkdir $APP_PATH
WORKDIR $APP_PATH

# rails server
EXPOSE 3000 
# yarn server
EXPOSE 3001
# for vscode debug
EXPOSE 1234
EXPOSE 26162

COPY scripts/dev_docker_entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/dev_docker_entrypoint.sh

# ENTRYPOINT [ "bundle", "exec" ]